package com.artrointel.everyonescomplication.crypto.model

import org.json.*
// use http://jsonviewer.stack.hu/ to parser debugging
// sample data
// {"status":{"timestamp":"2022-02-09T06:26:16.065Z","error_code":0,"error_message":null,"elapsed":20,"credit_count":1,"notice":null,"total_count":9327},"data":[{"id":1,"name":"Bitcoin","symbol":"BTC","slug":"bitcoin","num_market_pairs":9126,"date_added":"2013-04-28T00:00:00.000Z","tags":["mineable","pow","sha-256","store-of-value","state-channel","coinbase-ventures-portfolio","three-arrows-capital-portfolio","polychain-capital-portfolio","binance-labs-portfolio","blockchain-capital-portfolio","boostvc-portfolio","cms-holdings-portfolio","dcg-portfolio","dragonfly-capital-portfolio","electric-capital-portfolio","fabric-ventures-portfolio","framework-ventures-portfolio","galaxy-digital-portfolio","huobi-capital-portfolio","alameda-research-portfolio","a16z-portfolio","1confirmation-portfolio","winklevoss-capital-portfolio","usv-portfolio","placeholder-ventures-portfolio","pantera-capital-portfolio","multicoin-capital-portfolio","paradigm-portfolio"],"max_supply":21000000,"circulating_supply":18952718,"total_supply":18952718,"platform":null,"cmc_rank":1,"self_reported_circulating_supply":null,"self_reported_market_cap":null,"last_updated":"2022-02-09T06:25:00.000Z","quote":{"USD":{"price":43709.14946951065,"volume_24h":31859143764.651215,"volume_change_24h":5.6555,"percent_change_1h":0.94427969,"percent_change_24h":-3.33011973,"percent_change_7d":13.50825154,"percent_change_30d":4.13683903,"percent_change_60d":-9.75562915,"percent_change_90d":-32.31878181,"market_cap":828407183915.485,"market_cap_dominance":41.7303,"fully_diluted_market_cap":917892138859.72,"last_updated":"2022-02-09T06:25:00.000Z"}}},{"id":1027,"name":"Ethereum","symbol":"ETH","slug":"ethereum","num_market_pairs":5488,"date_added":"2015-08-07T00:00:00.000Z","tags":["mineable","pow","smart-contracts","ethereum-ecosystem","binance-smart-chain","coinbase-ventures-portfolio","three-arrows-capital-portfolio","polychain-capital-portfolio","binance-labs-portfolio","blockchain-capital-portfolio","boostvc-portfolio","cms-holdings-portfolio","dcg-portfolio","dragonfly-capital-portfolio","electric-capital-portfolio","fabric-ventures-portfolio","framework-ventures-portfolio","hashkey-capital-portfolio","kenetic-capital-portfolio","huobi-capital-portfolio","alameda-research-portfolio","a16z-portfolio","1confirmation-portfolio","winklevoss-capital-portfolio","usv-portfolio","placeholder-ventures-portfolio","pantera-capital-portfolio","multicoin-capital-portfolio","paradigm-portfolio"],"max_supply":null,"circulating_supply":119505415.249,"total_supply":119505415.249,"platform":null,"cmc_rank":2,"self_reported_circulating_supply":null,"self_reported_market_cap":null,"last_updated":"2022-02-09T06:25:00.000Z","quote":{"USD":{"price":3095.0470708059725,"volume_24h":16045482421.065126,"volume_change_24h":2.9027,"percent_change_1h":0.8594961,"percent_change_24h":-3.83468821,"percent_change_7d":11.46310024,"percent_change_30d":-2.23156305,"percent_change_60d":-22.89168542,"percent_change_90d":-33.38524668,"market_cap":369874885411.86884,"market_cap_dominance":18.6244,"fully_diluted_market_cap":369874885411.87,"last_updated":"2022-02-09T06:25:00.000Z"}}},{"id":825,"name":"Tether","symbol":"USDT","slug":"tether","num_market_pairs":27482,"date_added":"2015-02-25T00:00:00.000Z","tags":["payments","stablecoin","asset-backed-stablecoin","binance-smart-chain","avalanche-ecosystem","solana-ecosystem","moonriver-ecosystem"],"max_supply":null,"circulating_supply":77926851087.84462,"total_supply":80074697052.59753,"platform":{"id":1027,"name":"Ethereum","symbol":"ETH","slug":"ethereum","token_address":"0xdac17f958d2ee523a2206206994597c13d831ec7"},"cmc_rank":3,"self_reported_circulating_supply":null,"self_reported_market_cap":null,"last_updated":"2022-02-09T06:25:00.000Z","quote":{"USD":{"price":1.0006554499284812,"volume_24h":68100201003.175415,"volume_change_24h":-0.8766,"percent_change_1h":-0.00145552,"percent_change_24h":0.01377884,"percent_change_7d":0.02439329,"percent_change_30d":0.05140899,"percent_change_60d":0.01076154,"percent_change_90d":0.02273132,"market_cap":77977928236.81691,"market_cap_dominance":3.9281,"fully_diluted_market_cap":80127182007.05,"last_updated":"2022-02-09T06:25:00.000Z"}}},{"id":1839,"name":"BNB","symbol":"BNB","slug":"bnb","num_market_pairs":673,"date_added":"2017-07-25T00:00:00.000Z","tags":["marketplace","centralized-exchange","payments","smart-contracts","binance-smart-chain","alameda-research-portfolio","multicoin-capital-portfolio","moonriver-ecosystem"],"max_supply":165116760,"circulating_supply":165116760.89,"total_supply":165116760.89,"platform":null,"cmc_rank":4,"self_reported_circulating_supply":null,"self_reported_market_cap":null,"last_updated":"2022-02-09T06:25:00.000Z","quote":{"USD":{"price":413.83223179182323,"volume_24h":2198206589.4847374,"volume_change_24h":18.5585,"percent_change_1h":1.06487136,"percent_change_24h":-6.84403187,"percent_change_7d":7.83850493,"percent_change_30d":-6.60804553,"percent_change_60d":-27.15455619,"percent_change_90d":-33.52468112,"market_cap":68330637665.34553,"market_cap_dominance":3.4421,"fully_diluted_market_cap":68330637297.03,"last_updated":"2022-02-09T06:25:00.000Z"}}},{"id":3408,"name":"USD Coin","symbol":"USDC","slug":"usd-coin","num_market_pairs":2952,"date_added":"2018-10-08T00:00:00.000Z","tags":["medium-of-exchange","stablecoin","asset-backed-stablecoin","binance-smart-chain","fantom-ecosystem","moonriver-ecosystem"],"max_supply":null,"circulating_supply":51633448210.78166,"total_supply":51633448210.78166,"platform":{"id":1027,"name":"Ethereum","symbol":"ETH","slug":"ethereum","token_address":"0xa0b86991c6218b36c1d19d4a2e9eb0ce3606eb48"},"cmc_rank":5,"self_reported_circulating_supply":null,"self_reported_market_cap":null,"last_updated":"2022-02-09T06:25:00.000Z","quote":{"USD":{"price":0.9995891893756582,"volume_24h":3645653455.229869,"volume_change_24h":6.0218,"percent_change_1h":-0.00832043,"percent_change_24h":-0.06797866,"percent_change_7d":-0.0009704,"percent_change_30d":-0.01461534,"percent_change_60d":0.03866458,"percent_change_90d":-0.02096451,"market_cap":51612236641.68527,"market_cap_dominance":2.5988,"fully_diluted_market_cap":51612236641.69,"last_updated":"2022-02-09T06:25:00.000Z"}}},{"id":52,"name":"XRP","symbol":"XRP","slug":"xrp","num_market_pairs":677,"date_added":"2013-08-04T00:00:00.000Z","tags":["medium-of-exchange","enterprise-solutions","binance-chain","arrington-xrp-capital-portfolio","galaxy-digital-portfolio","a16z-portfolio","pantera-capital-portfolio"],"max_supply":100000000000,"circulating_supply":47832461678,"total_supply":99989769444,"platform":null,"cmc_rank":6,"self_reported_circulating_supply":null,"self_reported_market_cap":null,"last_updated":"2022-02-09T06:25:00.000Z","quote":{"USD":{"price":0.860710511182929,"volume_24h":5569202443.524487,"volume_change_24h":6.6477,"percent_change_1h":0.9987292,"percent_change_24h":-5.18333731,"percent_change_7d":37.05908404,"percent_change_30d":14.10861574,"percent_change_60d":3.72161035,"percent_change_90d":-29.20908867,"market_cap":41169902542.00924,"market_cap_dominance":2.073,"fully_diluted_market_cap":86071051118.29,"last_updated":"2022-02-09T06:25:00.000Z"}}},{"id":2010,"name":"Cardano","symbol":"ADA","slug":"cardano","num_market_pairs":362,"date_added":"2017-10-01T00:00:00.000Z","tags":["mineable","dpos","pos","platform","research","smart-contracts","staking","binance-smart-chain","cardano-ecosystem","cardano"],"max_supply":45000000000,"circulating_supply":33592728179.119,"total_supply":34066349127.639,"platform":null,"cmc_rank":7,"self_reported_circulating_supply":null,"self_reported_market_cap":null,"last_updated":"2022-02-09T06:25:00.000Z","quote":{"USD":{"price":1.176806043582874,"volume_24h":1909739358.224588,"volume_change_24h":-22.8887,"percent_change_1h":1.00361352,"percent_change_24h":-6.19624042,"percent_change_7d":8.95262133,"percent_change_30d":0.40012527,"percent_change_60d":-5.56082602,"percent_change_90d":-43.96998834,"market_cap":39532125541.623955,"market_cap_dominance":1.9906,"fully_diluted_market_cap":52956271961.23,"last_updated":"2022-02-09T06:25:00.000Z"}}},{"id":5426,"name":"Solana","symbol":"SOL","slug":"solana","num_market_pairs":248,"date_added":"2020-04-10T00:00:00.000Z","tags":["pos","platform","solana-ecosystem","cms-holdings-portfolio","kenetic-capital-portfolio","alameda-research-portfolio","multicoin-capital-portfolio","okex-blockdream-ventures-portfolio"],"max_supply":null,"circulating_supply":317331444.4292694,"total_supply":511616946.142289,"platform":null,"cmc_rank":8,"self_reported_circulating_supply":null,"self_reported_market_cap":null,"last_updated":"2022-02-09T06:25:00.000Z","quote":{"USD":{"price":111.35860354822299,"volume_24h":2467706895.1988344,"volume_change_24h":-1.259,"percent_change_1h":1.11062498,"percent_change_24h":-6.97890472,"percent_change_7d":1.20225398,"percent_change_30d":-22.0443583,"percent_change_60d":-34.77987164,"percent_change_90d":-54.06092767,"market_cap":35337586513.58396,"market_cap_dominance":1.7801,"fully_diluted_market_cap":56972948674.01,"last_updated":"2022-02-09T06:25:00.000Z"}}},{"id":4172,"name":"Terra","symbol":"LUNA","slug":"terra-luna","num_market_pairs":144,"date_added":"2019-07-26T00:00:00.000Z","tags":["cosmos-ecosystem","store-of-value","defi","payments","coinbase-ventures-portfolio","binance-labs-portfolio","solana-ecosystem","arrington-xrp-capital-portfolio","hashkey-capital-portfolio","kenetic-capital-portfolio","huobi-capital-portfolio","pantera-capital-portfolio","terra-ecosystem"],"max_supply":null,"circulating_supply":401321857.7814187,"total_supply":818521316.65542,"platform":null,"cmc_rank":9,"self_reported_circulating_supply":null,"self_reported_market_cap":null,"last_updated":"2022-02-09T06:25:00.000Z","quote":{"USD":{"price":55.557927560898506,"volume_24h":1725348963.6441011,"volume_change_24h":-18.9138,"percent_change_1h":0.5098646,"percent_change_24h":-6.85081181,"percent_change_7d":7.07593671,"percent_change_30d":-23.28185283,"percent_change_60d":-11.51059221,"percent_change_90d":11.83116659,"market_cap":22296610703.225273,"market_cap_dominance":1.1232,"fully_diluted_market_cap":45475348017.79,"last_updated":"2022-02-09T06:25:00.000Z"}}},{"id":5805,"name":"Avalanche","symbol":"AVAX","slug":"avalanche","num_market_pairs":189,"date_added":"2020-07-13T00:00:00.000Z","tags":["defi","smart-contracts","binance-smart-chain","polychain-capital-portfolio","avalanche-ecosystem","cms-holdings-portfolio","dragonfly-capital-portfolio","moonriver-ecosystem"],"max_supply":null,"circulating_supply":245207373.51553005,"total_supply":395891289.9134107,"platform":null,"cmc_rank":10,"self_reported_circulating_supply":null,"self_reported_market_cap":null,"last_updated":"2022-02-09T06:25:00.000Z","quote":{"USD":{"price":87.76534422212735,"volume_24h":1881934363.3092632,"volume_change_24h":34.8173,"percent_change_1h":1.76307595,"percent_change_24h":-4.46394081,"percent_change_7d":19.32359891,"percent_change_30d":-2.16082325,"percent_change_60d":6.26907762,"percent_change_90d":0.6598596,"market_cap":21520709542.39425,"market_cap_dominance":1.0841,"fully_diluted_market_cap":34745535333.79,"last_updated":"2022-02-09T06:25:00.000Z"}}}]}
class CryptoParser {
    var size = 0
    var cryptoInfoList: ArrayList<CryptoInfo> = ArrayList()

    fun load(jsonString: String): CryptoParser {
        cryptoInfoList.clear()

        var json = JSONObject(jsonString)
        var jsonDataArray = json.getJSONArray("data")

        size = jsonDataArray.length()

        for(i: Int in 0 until size) {
            val cryptoData = jsonDataArray.getJSONObject(i)
            val symbol = cryptoData.getString("symbol")
            val priceData = cryptoData.getJSONObject("quote").getJSONObject("USD")
            val price = priceData.getDouble("price")
            val percentChange1h = priceData.getDouble("percent_change_1h")
            val percentChange24h = priceData.getDouble("percent_change_24h")
            cryptoInfoList.add(CryptoInfo(symbol, price.toFloat(), convert = "USD", percentChange1h.toFloat(), percentChange24h.toFloat()))
        }
        return this
    }

    public fun getCryptoInfo(idx: Int): CryptoInfo {
        return cryptoInfoList.get(idx)
    }
}